<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Crona — Agendador</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      html,
      body,
      input,
      select,
      textarea,
      button {
        font-family: 'Inter', sans-serif !important;
      }
    </style>
    <!-- <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: { colors: { emerald: { 600: '#059669', 700: '#047857' } } },
        },
      };
    </script> -->
    <link rel="stylesheet" href="/dist/tailwind.css" />
  </head>

  <body
    class="min-h-screen bg-gray-50 text-gray-900 flex items-center justify-center p-6"
  >
    <main
      id="conteudoIndex"
      class="hidden max-w-md w-full bg-white shadow-xl rounded-2xl p-8 text-center space-y-8"
    >
      <div>
        <h1 class="text-3xl font-bold text-gray-900">Crona Agendador</h1>
        <p class="text-sm text-gray-600 mt-2">
          Sistema simples de agendamento e assinaturas digitais
        </p>
      </div>

      <div class="space-y-4">
        <a
          href="./pages/agendar.html"
          class="block w-full py-3 rounded-xl bg-black hover:bg-gray-800 text-white font-semibold transition"
        >
          Fazer Agendamento
        </a>
        <a
          href="./pages/painel.html"
          class="block w-full py-3 rounded-xl border border-gray-400 text-gray-800 hover:bg-gray-100 font-semibold transition"
        >
          Criar Novo Agendamento
        </a>
        <a
          href="./pages/login.html"
          class="block w-full py-3 rounded-xl border border-gray-400 text-gray-800 hover:bg-gray-100 font-semibold transition"
        >
          Entrar como Administrador
        </a>
      </div>

      <footer class="text-gray-500 text-xs pt-6 border-t">
        © <span id="year"></span> — Crona Agendador<br />
        <strong>Desenvolvido por Lincon Pereira</strong>
      </footer>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.1/dist/umd/supabase.min.js"></script>
    <script src="./js/env.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        document.getElementById('year').textContent = new Date().getFullYear();
        const supabase = window.supabase.createClient(
          window.env.SUPABASE_URL,
          window.env.SUPABASE_KEY,
        );

        // Se veio do painel com o parâmetro ?from=painel, não redireciona
        const params = new URLSearchParams(window.location.search);
        const fromPanel = params.get('from') === 'painel';

        const {
          data: { session },
        } = await supabase.auth.getSession();
        // Se existe sessão e NÃO veio de ?from=painel → redireciona automaticamente
        if (session && !fromPanel) {
          if (session.user.email.endsWith('@admin.com')) {
            window.location.href = './pages/painel_admin.html';
          } else {
            window.location.href = './pages/painel.html';
          }
        } else {
          // Caso contrário, mostra normalmente o conteúdo
          document.getElementById('conteudoIndex').classList.remove('hidden');
        }
      });
    </script>
  </body>
</html>
